{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\invite\\\\Documents\\\\servicescppf\\\\frontend\\\\src\\\\components\\\\ProtectedRoute.jsx\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from 'react';\nimport { Navigate } from 'react-router-dom';\nimport { utils } from '../services/api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ProtectedRoute = ({\n  children,\n  requiredUserType = null\n}) => {\n  _s();\n  const [isAuthenticated, setIsAuthenticated] = useState(null); // null = loading\n  const [userType, setUserType] = useState(null);\n  const [isLoading, setIsLoading] = useState(true);\n  useEffect(() => {\n    const checkAuth = async () => {\n      try {\n        // Vérifier si on a un token\n        const token = localStorage.getItem('auth_token');\n        if (!token) {\n          setIsAuthenticated(false);\n          setIsLoading(false);\n          return;\n        }\n\n        // Vérifier la validité du token avec le serveur\n        const response = await fetch('http://localhost:8000/api/auth/verify', {\n          headers: {\n            'Authorization': `Bearer ${token}`,\n            'Accept': 'application/json'\n          }\n        });\n        if (response.ok) {\n          setIsAuthenticated(true);\n\n          // Récupérer les données utilisateur pour déterminer le type\n          const userResponse = await fetch('http://localhost:8000/api/auth/user', {\n            headers: {\n              'Authorization': `Bearer ${token}`,\n              'Accept': 'application/json'\n            }\n          });\n          if (userResponse.ok) {\n            const userData = await userResponse.json();\n            if (userData.success) {\n              setUserType(userData.user.type);\n              // Mettre à jour le localStorage avec les données fraîches\n              localStorage.setItem('user_type', userData.user.type);\n              localStorage.setItem('user_data', JSON.stringify(userData.user));\n            }\n          }\n        } else {\n          // Token invalide\n          utils.clearSession();\n          setIsAuthenticated(false);\n        }\n      } catch (error) {\n        console.error('Erreur vérification auth:', error);\n        utils.clearSession();\n        setIsAuthenticated(false);\n      } finally {\n        setIsLoading(false);\n      }\n    };\n    checkAuth();\n  }, []);\n\n  // Affichage du loading\n  if (isLoading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        minHeight: '100vh',\n        flexDirection: 'column',\n        gap: '1rem'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          width: '2rem',\n          height: '2rem',\n          border: '3px solid #e5e7eb',\n          borderTop: '3px solid #3B82F6',\n          borderRadius: '50%',\n          animation: 'spin 1s linear infinite'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 77,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"V\\xE9rification de votre session...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 7\n    }, this);\n  }\n\n  // Si pas authentifié, rediriger vers les services\n  if (!isAuthenticated) {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/services\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Si un type d'utilisateur spécifique est requis, vérifier\n  if (requiredUserType && userType !== requiredUserType) {\n    // Rediriger vers le bon type de page selon l'utilisateur\n    const redirectPath = userType === 'actif' ? '/actifs/profil' : '/retraites/profil';\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: redirectPath,\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 12\n    }, this);\n  }\n\n  // Tout est OK, afficher le composant protégé\n  return children;\n};\n_s(ProtectedRoute, \"+D3nu0ZmFFr24ePT+UvMG6Qb+kI=\");\n_c = ProtectedRoute;\nexport default ProtectedRoute;\nvar _c;\n$RefreshReg$(_c, \"ProtectedRoute\");","map":{"version":3,"names":["React","useState","useEffect","Navigate","utils","jsxDEV","_jsxDEV","ProtectedRoute","children","requiredUserType","_s","isAuthenticated","setIsAuthenticated","userType","setUserType","isLoading","setIsLoading","checkAuth","token","localStorage","getItem","response","fetch","headers","ok","userResponse","userData","json","success","user","type","setItem","JSON","stringify","clearSession","error","console","style","display","justifyContent","alignItems","minHeight","flexDirection","gap","width","height","border","borderTop","borderRadius","animation","fileName","_jsxFileName","lineNumber","columnNumber","to","replace","redirectPath","_c","$RefreshReg$"],"sources":["C:/Users/invite/Documents/servicescppf/frontend/src/components/ProtectedRoute.jsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { Navigate } from 'react-router-dom';\r\nimport { utils } from '../services/api';\r\n\r\nconst ProtectedRoute = ({ children, requiredUserType = null }) => {\r\n  const [isAuthenticated, setIsAuthenticated] = useState(null); // null = loading\r\n  const [userType, setUserType] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const checkAuth = async () => {\r\n      try {\r\n        // Vérifier si on a un token\r\n        const token = localStorage.getItem('auth_token');\r\n        if (!token) {\r\n          setIsAuthenticated(false);\r\n          setIsLoading(false);\r\n          return;\r\n        }\r\n\r\n        // Vérifier la validité du token avec le serveur\r\n        const response = await fetch('http://localhost:8000/api/auth/verify', {\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`,\r\n            'Accept': 'application/json',\r\n          }\r\n        });\r\n\r\n        if (response.ok) {\r\n          setIsAuthenticated(true);\r\n          \r\n          // Récupérer les données utilisateur pour déterminer le type\r\n          const userResponse = await fetch('http://localhost:8000/api/auth/user', {\r\n            headers: {\r\n              'Authorization': `Bearer ${token}`,\r\n              'Accept': 'application/json',\r\n            }\r\n          });\r\n\r\n          if (userResponse.ok) {\r\n            const userData = await userResponse.json();\r\n            if (userData.success) {\r\n              setUserType(userData.user.type);\r\n              // Mettre à jour le localStorage avec les données fraîches\r\n              localStorage.setItem('user_type', userData.user.type);\r\n              localStorage.setItem('user_data', JSON.stringify(userData.user));\r\n            }\r\n          }\r\n        } else {\r\n          // Token invalide\r\n          utils.clearSession();\r\n          setIsAuthenticated(false);\r\n        }\r\n      } catch (error) {\r\n        console.error('Erreur vérification auth:', error);\r\n        utils.clearSession();\r\n        setIsAuthenticated(false);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n\r\n    checkAuth();\r\n  }, []);\r\n\r\n  // Affichage du loading\r\n  if (isLoading) {\r\n    return (\r\n      <div style={{\r\n        display: 'flex',\r\n        justifyContent: 'center',\r\n        alignItems: 'center',\r\n        minHeight: '100vh',\r\n        flexDirection: 'column',\r\n        gap: '1rem'\r\n      }}>\r\n        <div style={{\r\n          width: '2rem',\r\n          height: '2rem',\r\n          border: '3px solid #e5e7eb',\r\n          borderTop: '3px solid #3B82F6',\r\n          borderRadius: '50%',\r\n          animation: 'spin 1s linear infinite'\r\n        }}></div>\r\n        <p>Vérification de votre session...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Si pas authentifié, rediriger vers les services\r\n  if (!isAuthenticated) {\r\n    return <Navigate to=\"/services\" replace />;\r\n  }\r\n\r\n  // Si un type d'utilisateur spécifique est requis, vérifier\r\n  if (requiredUserType && userType !== requiredUserType) {\r\n    // Rediriger vers le bon type de page selon l'utilisateur\r\n    const redirectPath = userType === 'actif' ? '/actifs/profil' : '/retraites/profil';\r\n    return <Navigate to={redirectPath} replace />;\r\n  }\r\n\r\n  // Tout est OK, afficher le composant protégé\r\n  return children;\r\n};\r\n\r\nexport default ProtectedRoute;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}